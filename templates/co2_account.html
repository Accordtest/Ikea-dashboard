<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CO₂ Regnskab</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>CO₂ Regnskab</h1>

        <!-- Samlet CO₂-aftryk -->
        <h2>Samlet CO<sub>2</sub>-aftryk:</h2>
        <p style="color: {{ 'red' if total_co2 > 0 else 'green' }}; font-size: 1.5em; font-weight: bold;">
            {{ total_co2 }} kg CO<sub>2</sub>
        </p>

        <!-- Donationsopfordring -->
        {% if donation_info.trees_needed > 0 %}
        <h2>Forbedr dit CO<sub>2</sub>-regnskab:</h2>
        <p>{{ donation_info.message }}</p>
        <button class="button" id="donateButton">Donér {{ donation_info.donation_amount }} kr.</button>
        <p id="donationMessage" style="display: none; color: green; font-weight: bold;">
            Tak for din donation! Du er nu på vej mod et bedre CO₂-regnskab.
        </p>
        {% else %}
        <h2>Tillykke!</h2>
        <p>Du har allerede et fantastisk CO<sub>2</sub>-regnskab. Fortsæt det gode arbejde!</p>
        {% endif %}

        <!-- Diagrammer -->
        <h2>Cirkeldiagram: Køb vs Leje</h2>
        <canvas id="co2PieChart" width="400" height="400"></canvas>

        <h2>Søjlediagram: CO<sub>2</sub> pr. Produkt</h2>
        <canvas id="co2BarChart" width="400" height="400"></canvas>
        </div>
        <!-- Navigation -->
         <a href="{{ url_for('dashboard', username=username) }}" class="button">Tilbage til Dashboard</a>
         <a href="{{ url_for('logout') }}" class="button">Log ud</a>
        </div>
    <script>
        // Data fra serveren
        const purchaseData = {{ purchase_data | tojson | safe }};
        const rentalData = {{ rental_data | tojson | safe }};

        // Kombinér køb og leje data
        const allData = {
            ...Object.fromEntries(Object.entries(purchaseData).map(([key, value]) => [key + " (køb)", value])),
            ...Object.fromEntries(Object.entries(rentalData).map(([key, value]) => [key + " (leje)", value]))
        };

        const allLabels = Object.keys(allData); // Produktnavne
        const allValues = Object.values(allData); // CO₂ værdier
        const allColors = Object.keys(purchaseData).map(() => "red").concat(Object.keys(rentalData).map(() => "green"));

        // Cirkeldiagram
        const pieCtx = document.getElementById('co2PieChart').getContext('2d');
        new Chart(pieCtx, {
            type: 'pie',
            data: {
                labels: allLabels,
                datasets: [{
                    data: allValues,
                    backgroundColor: allColors
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw} kg CO₂`;
                            }
                        }
                    }
                }
            }
        });

        // Søjlediagram
        const barCtx = document.getElementById('co2BarChart').getContext('2d');
        new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: allLabels,
                datasets: [{
                    label: "CO₂ i kg",
                    data: allValues,
                    backgroundColor: allColors
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Donationsknap funktion
        document.getElementById('donateButton')?.addEventListener('click', () => {
            document.getElementById('donationMessage').style.display = 'block';
        });
    </script>
</body>
</html>
    